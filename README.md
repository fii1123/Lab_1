# lab-work-1
Лабораторная работа No 1. Сбор статистики по сетевому трафику

## Описание

Данный набор утилит разработан для анализа входящих пакетов на конкретный сетевой интерфейс.

Набор представляет из себя 2 утилиты:
1. packet_filter — собирает пакеты и формирует статистику. Имеет 2 версии:
* версия a - с вычилсением статистики на втором потоке;
* версия b - вычисление статистики в первом потоке.
2. statistics-printer — запрашивает у packet_filter статистику и выводит её на экран.

    
## Сборка

Для сборки программ вам потребуется пакет GNU GCC.
В принципе, все что нужно, это:
1. Скачать средства сборки: `sudo apr-get install gcc`
2. Перейти в директорию с Makefile и запустить make `make install`

Чтобы в текущей директории были созданы исполняемые файлы, исплользуйте `make all`

## Запуск

Для запуска программ необходимы права суперпользователя. Синопсис:

`sudo packet_filter [имя сетевого интерфейса (enp0s5 и пр.)] [OPTION]`

Также, утилита использует следующие параметры для фильтрации статистики:

`-sa <source address>`

`-sp <source port>`

`-da <destination address>`

`-dp <destination port>`

Ключи можно распологать в любом порядке.

Чтобы узнать доступные сетевые интерфейсы, можно возспользоваться командой `networkctl`

Программа packet_filter «ловит» поступающие на сетевой интерфейс пакеты до тех пор, пока не будет принудительно выключена.
Для получения статистики используется утилита statistics-printer:

`sudo statistics-printer`

Утилита получит от packet_filter статистику всех пакетов, пришедших на указанный сетевой интерфейс с момента запуска packet_filter и до запуска statistics-printer.

Для тестирования работоспособности программы рекомендуется следующее:
1. Запустить сбор статистики по loopback `sudo ./packet_filter lo`
2. Отправить несколько пакетов на локальный адресс. Например, с помощью netcat
3. Запусить вывод статистики `sudo ./statistics-printer`

Утилита statistics-printer выведет информацию о каждом пакете, и в конце отобразит число полученных пакетов и их общий размер.

## Результаты профилирования двух реализованных вариантов утилиты для сбора статистики

Утилита packet_filter (которая занимается сбором статистики) состоит из двух потоков:
Первый - прослушивает сетевой интерфейс и анализирует пакеты;
Второй - отправляет информацию в statistics-printer.

Для профилирования было разработано 2 варианта утилиты packet_filter:
* packet_filter_a - подсчет статистики (общего размера всех пакетов) производит второй поток.
* packet_filter_b - подсчет статистики идет при анализу пакета.

Профилирование производилос утилитой pidstat.
Для каждой программы выполнялся запуск, отправка 6 пакетов и вывод статистики трафика, после чего было вычесленно среднее значение нагрузки на CPU.

Результаты следующие:
```
Среднее:   UID       PID    %usr  Command
Среднее:     0      2410   61,18  packet_filter_a
Среднее:     0      2456   59,66  packet_filter_b
```
Таким образом, первый вариант нагружает процессор на 1,52%.

## Авторство и лицензия

Разработчик: Филатов И.А.
e-mail: f2000_99@mail.ru

Лицензия GNU GPL v.3
